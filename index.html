<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8" />
<title>Survival Game</title>

<style>
html, body {
  margin: 0;
  padding: 0;
  background: #0e0e0e;
  color: #a87c4a;
  font-family: Arial, sans-serif;
  height: 100%;
}

/* --- STRUTTURA --- */
#game {
  position: relative;
  width: 100%;
  height: 100vh;
  overflow: hidden;
}

/* --- AREA MISSIONE --- */
#mission {
  position: absolute;
  top: 4%;
  left: 50%;
  transform: translateX(-50%);
  width: 70%;
  text-align: center;
  font-size: 1.6rem;
  z-index: 10;
}

/* --- DADO --- */
#dice {
  position: absolute;
  top: 40%;
  left: 50%;
  transform: translate(-50%, -50%);
  width: 120px;
  height: 120px;
  border: 2px solid #a87c4a;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 3rem;
  cursor: pointer;
  user-select: none;
  z-index: 20;
}

/* --- AZIONI --- */
#actions {
  position: absolute;
  top: 55%;
  left: 50%;
  transform: translateX(-50%);
  display: flex;
  gap: 16px;
  z-index: 30;
}

button {
  background: transparent;
  border: 1px solid #a87c4a;
  color: #a87c4a;
  padding: 10px 18px;
  cursor: pointer;
  font-size: 1rem;
}

button:hover {
  background: rgba(168,124,74,0.15);
}

/* --- STATISTICHE --- */
.stats {
  position: absolute;
  bottom: 4%;
  left: 50%;
  transform: translateX(-50%);
  display: flex;
  gap: 40px;
  z-index: 10;
}

.stat {
  display: flex;
  gap: 4px;
}

.box {
  width: 16px;
  height: 16px;
  border: 1px solid #a87c4a;
}

.box.filled {
  background: #a87c4a;
}

/* --- SICUREZZA CLICK --- */
* {
  pointer-events: auto;
}
</style>
</head>

<body>

<div id="game">

  <div id="mission">
    Ti trovi tra le rovine di una città devastata. Il silenzio è innaturale.
  </div>

  <div id="dice">?</div>

  <div id="actions">
    <button onclick="doAction('esplora')">Esplora</button>
    <button onclick="doAction('cerca')">Cerca</button>
    <button onclick="doAction('riposa')">Riposa</button>
  </div>

  <div class="stats">
    <div class="stat" id="salute"></div>
    <div class="stat" id="stress"></div>
    <div class="stat" id="risorse"></div>
  </div>

</div>

<script>
/* --- CONFIG --- */
const WORKER_URL = "https://still-hat-5795.salvatifranc.workers.dev";

/* --- STATO GIOCO --- */
let state = {
  salute: 4,
  stress: 2,
  risorse: 3
};

/* --- UI --- */
function renderStats() {
  ["salute", "stress", "risorse"].forEach(key => {
    const el = document.getElementById(key);
    el.innerHTML = "";
    for (let i = 0; i < 6; i++) {
      const box = document.createElement("div");
      box.className = "box" + (i < state[key] ? " filled" : "");
      el.appendChild(box);
    }
  });
}

renderStats();

/* --- DADO --- */
document.getElementById("dice").onclick = () => {
  const roll = Math.floor(Math.random() * 6) + 1;
  document.getElementById("dice").innerText = roll;
};

/* --- AZIONI + AI --- */
async function doAction(action) {
  document.getElementById("mission").innerText = "…";

  const payload = {
    last_action: action,
    player_state: state
  };

  try {
    const res = await fetch(WORKER_URL, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(payload)
    });

    const text = await res.text();

    let data;
    try {
      data = JSON.parse(text);
    } catch {
      document.getElementById("mission").innerText = text;
      return;
    }

    if (data.state) state = data.state;
    if (data.narrazione)
      document.getElementById("mission").innerText = data.narrazione;

    renderStats();

  } catch (e) {
    document.getElementById("mission").innerText =
      "Errore di connessione con l'IA.";
  }
}
</script>

</body>
</html>
